<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from www.apache.org/dev/cmsref.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jun 2019 09:33:31 GMT -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Home page of The Apache Software Foundation">
  
  <link rel="apple-touch-icon" sizes="57x57" href="http://www.apache.org/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="http://www.apache.org/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="http://www.apache.org/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="http://www.apache.org/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="http://www.apache.org/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="http://www.apache.org/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="http://www.apache.org/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="http://www.apache.org/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="http://www.apache.org/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="http://www.apache.org/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="http://www.apache.org/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="http://www.apache.org/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="http://www.apache.org/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="http://www.apache.org/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="http://www.apache.org/favicons/manifest.json">
  <link rel="shortcut icon" href="http://www.apache.org/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#603cba">
  <meta name="msapplication-TileImage" content="http://www.apache.org/favicons/mstile-144x144.png">
  <meta name="msapplication-config" content="http://www.apache.org/favicons/browserconfig.xml">
  <meta name="theme-color" content="#282661">

  <title>CMS Reference</title>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:300,600" rel="stylesheet">
  <link href="http://www.apache.org/css/min.bootstrap.css" rel="stylesheet">
  <link href="http://www.apache.org/css/styles.css" rel="stylesheet">
  

  <!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file to you under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with the License.  You may obtain a copy of the License at . http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the specific language governing permissions and limitations under the License. -->

</head>

<body>
  <!-- Navigation -->
  <header>
    <nav class="navbar navbar-inverse navbar-fixed-top mainmenu">
      <div class="container">
        <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#mainnav-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="collapse navbar-collapse" id="mainnav-collapse">
          <ul class="nav navbar-nav navbar-justified">
            <li>
              <form class="visible-xs">
                <div class="input-group" style="width: 100%;">
                  <script>
                    (function() {
                    var cx = '005703438322411770421:5mgshgrgx2u';
                    var gcse = document.createElement('script');
                    gcse.type = 'text/javascript';
                    gcse.async = true;
                    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                    '//cse.google.com/cse.js?cx=' + cx;
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(gcse, s);
                    })();
                  </script>
                  <gcse:searchbox-only></gcse:searchbox-only>
                </div>
              </form>
            </li>
            <li><a href="http://www.apache.org/index.html#news">News</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">About&nbsp;<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="http://www.apache.org/foundation">Overview</a></li>
                <li><a href="http://www.apache.org/foundation/how-it-works.html">Process</a></li>
                <li><a href="http://www.apache.org/foundation/governance/">Governance</a></li>
                <li><a href="http://www.apache.org/theapacheway/index.html">The Apache Way</a></li>
                <li><a href="http://www.apache.org/foundation/governance/members.html">Membership</a></li>
                <li><a href="https://community.apache.org/">Community</a></li>
                <li><a href="http://www.apache.org/foundation/glossary.html">Glossary</a></li>
                <li><a href="http://www.apache.org/foundation/preFAQ.html">FAQ</a></li>
                <li><a href="http://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
                <li><a href="http://www.apache.org/foundation/contributing.html">Support Apache</a></li>
                <li><a href="http://www.apache.org/press/">Media/Analysts</a></li>
                <li><a href="http://www.apache.org/foundation/contact.html">Contact</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Make a Donation&nbsp;<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="http://www.apache.org/foundation/contributing.html">Donate Now</a></li>
                <li><a href="https://donate.apache.org/">&nbsp;&nbsp;Via Credit Card</a></li>
                <li><a href="https://donate.apache.org/">&nbsp;&nbsp;Via ACH</a></li>
                <li><a href="https://donate.apache.org/">&nbsp;&nbsp;Via PayPal</a></li>
                <li><a href="http://www.apache.org/foundation/contributing.html#Bitcoin">&nbsp;&nbsp;Using Bigcoin</a></li>
                <li><a href="https://www.redbubble.com/people/comdev">Buy Swag</a></li>
                <li><a href="https://smile.amazon.com/gp/chpf/homepage/ref=smi_se_scyc_srch_stsr?q=apache+software+foundation&amp;orig=%2F">Shop smile.amazon.com</a></li>
                <li><a href="http://www.apache.org/foundation/sponsorship.html">ASF Sponsorship</a></li>
                <li><a href="http://www.apache.org/foundation/thanks#targeted-sponsors">Targeted Sponsorship</a></li>
                <li><a href="http://www.apache.org/foundation/contributing.html#CorporateGiving">Corporate Giving</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdopwn-toggle" data-toggle="dropdown">The Apache Way&nbsp;<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="http://www.apache.org/theapacheway/index.html">The Apache Way</a></li>
                <li><a href="https://s.apache.org/GhnI">Sustainable Open Source</a></li>
                <li><a href="http://www.apache.org/foundation/how-it-works.html">How it Works</a></li>
                <li><a href="http://www.apache.org/foundation/how-it-works.html#meritocracy">Merit</a></li>
                <li><a href="https://blogs.apache.org/foundation/category/SuccessAtApache">Success at Apache</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdopwn-toggle" data-toggle="dropdown">Join Us&nbsp;<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="https://community.apache.org/gettingStarted/101.html">Getting Started</a></li>
                <li><a href="https://helpwanted.apache.org/">Help Wanted</a></li>
                <li><a href="https://www.apachecon.com/">ApacheCon</a></li>
                <li><a href="http://community.apache.org/calendars/">Community Events</a></li>
                <li><a href="http://www.apache.org/travel/">Travel Assistance</a></li>
                <li><a href="https://community.apache.org/gsoc.html">Summer of Code</a></li>
                <li><a href="http://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
                <li><a href="https://community.apache.org/contributors/etiquette">Etiquette</a></li>
                <li class="dropdown dropdown-submenu visible-xs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Projects&nbsp;<span class="caret"></span></a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="http://www.apache.org/index.html#projects-list">Project List</a></li>
                    <li><a href="http://www.apache.org/foundation/how-it-works.html#management">How they work</a></li>
                    <li><a href="https://community.apache.org/projectIndependence.html">Independence</a></li>
                    <li><a href="https://projects.apache.org/committees.html?date">Date Founded</a></li>
                    <li><a href="https://projects.apache.org/projects.html?name">Names</a></li>
                    <li><a href="https://projects.apache.org/projects.html?category">Categories</a></li>
                    <li><a href="https://projects.apache.org/projects.html?language">Languages</a></li>
                    <li><a href="https://projects.apache.org/statistics.html">Statistics</a></li>
                    <li><a href="https://incubator.apache.org/">Apache Incubator</a></li>
                    <li><a href="https://helpwanted.apache.org/">Help Wanted</a></li>
                    <li><a href="http://www.apache.org/foundation/marks/">Brand Management</a></li>
                  </ul>
                </li>
                <li class="drowpdown dropdown-submenu visible-xs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">People&nbsp;<span class="caret"></span></a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="http://www.apache.org/foundation/how-it-works.html#roles">Roles</a></li>
                    <li><a href="http://www.apache.org/foundation/members.html">Members</a></li>
                    <li><a href="https://community.apache.org/contributors/">Committers</a></li>
                    <li><a href="http://www.apache.org/foundation/#who-runs-the-asf">Board of Directors</a></li>
                    <li><a href="http://www.apache.org/foundation/#who-runs-the-asf">Officers  &amp; Project VPs</a></li>
                    <li><a href="https://community.zones.apache.org/map.html">Location Map</a></li>
                    <li><a href="http://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
                    <li><a href="https://people.apache.org/">Committer Directory</a></li>
                  </ul>
                </li>
                <li class="drowpdown dropdown-submenu visible-xs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Community&nbsp;<span class="caret"></span></a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="https://community.apache.org/about/">Community Development</a></li>
                    <li><a href="http://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
                    <li><a href="https://community.apache.org/">Get Involved</a></li>
                    <li><a href="https://community.apache.org/mentoringprogramme.html">Mentoring</a></li>
                    <li><a href="https://helpwanted.apache.org/">Help Wanted</a></li>
                    <li><a href="https://community.apache.org/calendars/">Community Events</a></li>
                    <li><a href="https://community.apache.org/newbiefaq.html">FAQ</a></li>
                    <li><a href="https://community.apache.org/lists.html">Mailing Lists</a></li>
                  </ul>
                </li>
                <li class="drowpdown dropdown-submenu visible-xs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">License&nbsp;<span class="caret"></span></a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a></li>
                    <li><a href="http://www.apache.org/foundation/license-faq.html">Licensing FAQ</a></li>
                    <li><a href="http://www.apache.org/licenses/contributor-agreements.html">Contributor License Agreements</a></li>
                    <li><a href="http://www.apache.org/licenses/contributor-agreements.html#grants">Software Grants</a></li>
                    <li><a href="http://www.apache.org/foundation/marks/list/">Trademarks</a></li>
                  </ul>
                </li>
                <li class="drowpdown dropdown-submenu visible-xs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Sponsors&nbsp;<span class="caret"></span></a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsor the ASF</a></li>
                    <li><a href="http://www.apache.org/foundation/thanks">Sponsor Thanks</a></li>
                    <li><a href="http://www.apache.org/foundation/contributing.html#CorporateGiving">Corporate Giving</a></li>
                    <li><a href="http://www.apache.org/foundation/contributing.html">Individual Donations</a></li>
                    <li><a href="https://www.redbubble.com/people/comdev/">Buy Stuff</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Downloads&nbsp;<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="http://www.apache.org/dist/">Distribution</a></li>
                <li><a href="https://projects.apache.org/releases.html">Releases</a></li>
                <li><a href="http://www.apache.org/dyn/closer.cgi">Mirrors</a></li>
                <li><a href="https://status.apache.org/">Infrastructure Status</a></li>
                <li><a href="http://www.apache.org/uptime/">Infrastructure Statistics</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-search"
                  aria-hidden="true"></span><span class="sr-only">Search</span></a>
              <ul class="dropdown-menu search-form" role="search">
                <li>
                  <div class="input-group" style="width: 100%; padding: 0 5px;">
                    <script>
                      (function() {
                      var cx = '005703438322411770421:5mgshgrgx2u';
                      var gcse = document.createElement('script');
                      gcse.type = 'text/javascript';
                      gcse.async = true;
                      gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                      '//cse.google.com/cse.js?cx=' + cx;
                      var s = document.getElementsByTagName('script')[0];
                      s.parentNode.insertBefore(gcse, s);
                      })();
                    </script>
                    <gcse:searchbox-only></gcse:searchbox-only>
                  </div>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>
  <!-- / Navigation -->
  <header id="main-header" class="container">
    <div class="sideImg">
      <a class="visible-home" href="http://apachecon.com/"><img class="img-responsive" src="http://www.apache.org/img/ApacheCon-PROMO-2019.gif" alt="ApacheCon is Coming 9-12 Sept. 2019 - Las Vegas"></a>
      <a class="hidden-home" href="http://www.apache.org/"><img class="img-responsive" src="http://www.apache.org/img/ASF20thAnniversary.jpg" alt="The Apache Software Foundation"></a>
    </div>
    <div class="main">
      <img class="img-responsive center-block visible-home" src="http://www.apache.org/img/ASF20thAnniversary.jpg" alt="Apache 20th Anniversary Logo">
      <h2 class="text-center">Celebrating 20 years of community-led development "The&nbsp;Apache&nbsp;Way"</h2>
      <ul class="nav navbar-nav navbar-justified">
        <li class="drowpdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Projects&nbsp;<span class="caret hidden-sm"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="http://www.apache.org/index.html#projects-list">Project List</a></li>
            <li><a href="#">How they work</a></li>
            <li><a href="https://community.apache.org/projectIndependence.html">Independence</a></li>
            <li><a href="https://projects.apache.org/committees.html?date">Date Founded</a></li>
            <li><a href="https://projects.apache.org/projects.html?name">Names</a></li>
            <li><a href="https://projects.apache.org/projects.html?category">Categories</a></li>
            <li><a href="https://projects.apache.org/projects.html?language">Languages</a></li>
            <li><a href="https://projects.apache.org/statistics.html">Statistics</a></li>
            <li><a href="https://incubator.apache.org/">Apache Incubator</a></li>
            <li><a href="https://helpwanted.apache.org/">Help Wanted</a></li>
            <li><a href="http://www.apache.org/foundation/marks/">Brand Management</a></li>
            <li><a href="http://www.apache.org/foundation/glossary.html">Glossary of Terms</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">People&nbsp;<span class="caret hidden-sm"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="http://www.apache.org/foundation/how-it-works.html#roles">Roles</a></li>
            <li><a href="http://www.apache.org/foundation/members.html">Members</a></li>
            <li><a href="https://community.apache.org/contributors/">Committers</a></li>
            <li><a href="http://www.apache.org/foundation/#who-runs-the-asf">Board of Directors</a></li>
            <li><a href="http://www.apache.org/foundation/#who-runs-the-asf">Officers &amp; Product VPs</a></li>
            <li><a href="https://community.zones.apache.org/map.html">Heat Map</a></li>
            <li><a href="http://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
            <li><a href="https://people.apache.org/">Committer Directory</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Community&nbsp;<span class="caret hidden-sm"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="https://community.apache.org/about/">Community Development</a></li>
            <li><a href="http://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
            <li><a href="https://community.apache.org/">Get Involved</a></li>
            <li><a href="https://community.apache.org/mentoringprogramme.html">Mentoring</a></li>
            <li><a href="https://helpwanted.apache.org/">Help Wanted</a></li>
            <li><a href="https://community.apache.org/calendars/">Community Events</a></li>
            <li><a href="https://community.apache.org/newbiefaq.html">FAQ</a></li>
            <li><a href="https://community.apache.org/lists.html">Mailing Lists</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">License&nbsp;<span class="caret hidden-sm"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a></li>
            <li><a href="http://www.apache.org/foundation/license-faq.html">Licensing FAQ</a></li>
            <li><a href="http://www.apache.org/licenses/contributor-agreements.html">Contributor License Agreements</a></li>
            <li><a href="http://www.apache.org/licenses/contributor-agreements.html#grants">Software Grants</a></li>
            <li><a href="http://www.apache.org/foundation/marks/list/">Trademarks</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Sponsors&nbsp;<span class="caret hidden-sm"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsor the ASF</a></li>
            <li><a href="http://www.apache.org/foundation/thanks">Sponsor Thanks</a></li>
            <li><a href="http://www.apache.org/foundation/contributing.html#CorporateGiving">Corporate Giving</a></li>
            <li><a href="http://www.apache.org/foundation/contributing.html">Individual Donations</a></li>
            <li><a href="https://www.redbubble.com/people/comdev/">Buy Stuff</a></li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="sideImg">
      <a href="http://www.apache.org/foundation/contributing.html"><img class="img-responsive" src="http://www.apache.org/img/support-apache.jpg" alt="Apache Support Logo" /></a>
    </div>
  </header>
  <div class="container"><style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, p:hover > .elementid-permalink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p>The ASF Content Management System (CMS) is used to edit, manage, 
and deploy web content for many Apache projects, including this <code>apache.org</code> top level website.</p>
<p>You can <a href="http://www.apache.org/dev/cms.html#usage">Get Started Editing A Page</a>, 
<a href="http://s.apache.org/cms-tutorial">watch a video tutorial for committers</a>, 
<a href="http://s.apache.org/cms-anonymous-tutorial">watch a non-committer's video tutorial</a>, 
or read on below for the reference manual and <a href="#faq">FAQs</a>.</p>
<p>There is a list of <a href="http://cms.apache.org/">Apache projects using the CMS</a> to manage their websites.</p>
<h1 id="links">Contents<a class="headerlink" href="#links" title="Permanent link">&para;</a></h1>
<div class="toc">
<ul>
<li><a href="#links">Contents</a></li>
<li><a href="#markdown">CMS Supported Markdown Formats</a></li>
<li><a href="#flow">CMS Information Flow - Edit/Commit, Build, Stage, Publish</a><ul>
<li><a href="#staging">Staging</a></li>
<li><a href="#publishing">Publishing</a></li>
</ul>
</li>
<li><a href="#faq">FAQ - Anonymous/Non-Committer Use</a><ul>
<li><a href="#non-committer">I'm not a committer on $project, which uses the CMS.  Can I still use the CMS?</a><ul>
<li><a href="#anonymous-contributions">Information for committers working with anonymous contributions</a></li>
</ul>
</li>
<li><a href="#anonymous-add">I'm having trouble committing changes from an anonymous clone after applying changes which added files or directories.</a></li>
</ul>
</li>
<li><a href="#faq-how-to-use-editing-tools">FAQ - How To Use Editing Tools</a><ul>
<li><a href="#quick-commit">What is Quick Commit and why would I use it?</a></li>
<li><a href="#bookmarklet-edit">Why doesn't the bookmarklet take me directly to the Edit screen for a page?</a></li>
<li><a href="#new-file-diffs">How come the publish link doesn't show diffs of newly added files?</a></li>
<li><a href="#link-safety">Is it safe to click on the Static, Staged, or Production links?  What do each of these do?</a></li>
<li><a href="#force-site-build">How do I force the CMS to do a full site build?</a></li>
<li><a href="#add-resource">How do I add a new file or directory to my site?</a></li>
<li><a href="#svnpubsub-revision">What revision of the site is currently being served?</a></li>
<li><a href="#cleanup">We've completely restructured our site and now there are a lot of leftover files on the live site.  How do we clean things up?</a></li>
<li><a href="#executables">Help!  My download cgi scripts are serving up Internal Server Errors!</a></li>
</ul>
</li>
<li><a href="#faq-markdown-and-content-questions">FAQ - Markdown and Content Questions</a><ul>
<li><a href="#django-version">What version of Django's template library does the CMS use?</a></li>
<li><a href="#code-hilighter">How do I use the code highlighter?</a></li>
<li><a href="#nested-lists">How come my nested lists don't render properly?</a></li>
<li><a href="#markdown-conversion">How do I verify the markdown -&gt; html conversion by the python implementation, before committing my changes?</a></li>
<li><a href="#navigation">How do I create per-directory navigation links in the CMS?</a></li>
<li><a href="#mail-link">How do I make the mail archives for my TLP accessible through the /mail URL?</a></li>
</ul>
</li>
<li><a href="#faq-cms-command-line-build-tools">FAQ - CMS Command Line Build Tools</a><ul>
<li><a href="#local-build">How do I run the CMS build scripts?</a></li>
<li><a href="#external-build">How do I use the CMS with an external build system?</a></li>
<li><a href="#compat">How do I verify compatibility if I write a client app for the CMS?</a></li>
<li><a href="#generated-docs">How do I publish generated docs (eg. doxygen)?</a></li>
<li><a href="#extpaths">What is extpaths.txt?</a></li>
<li><a href="#buildbot-commits">Is there any way to turn off all these annoying buildbot commit messages appearing on our commit lists?</a></li>
<li><a href="#mass-change">Help!  I made a massive commit to my CMS source tree and now I cannot use the CMS webgui, not even to publish the site!</a></li>
<li><a href="#log-prod-child">Running svn log on a file in the production tree gives too many results!</a></li>
<li><a href="#log-prod-staging">Running svn log on the production tree shows entries from staging.</a></li>
</ul>
</li>
<li><a href="#techinfo">Technical Information About The CMS</a><ul>
<li><a href="#svn">How To Setup A New CMS Site</a></li>
<li><a href="#organization">Organization of the webgui pages</a></li>
<li><a href="#exception">Single REST exception regarding commits</a></li>
<li><a href="#control-flow">Control Flow of the Standard Build System</a></li>
<li><a href="#walkthrough">Detailed Walkthrough Of Edit/Commit, Build, Stage, Publish</a><ul>
<li><a href="#core-logic">Core logic for building files</a></li>
<li><a href="#examples">Examples</a><ul>
<li><a href="#first">First example</a></li>
<li><a href="#second">Second example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="markdown">CMS Supported Markdown Formats<a class="headerlink" href="#markdown" title="Permanent link">&para;</a></h1>
<p>The mdtext files CMS users edit are converted to html for publishing with
<a href="https://pypi.python.org/pypi/Markdown">python markdown</a>.
This is documented <a href="https://pypi.python.org/pypi/Markdown">here</a>.</p>
<p>The general markup syntax is described in <a href="http://daringfireball.net/projects/markdown/syntax">http://daringfireball.net/projects/markdown/syntax</a></p>
<p>The following extensions are enabled for the CMS, which extend the markdown syntax available:</p>
<ul>
<li><a href="https://pythonhosted.org/Markdown/extensions/tables.html">tables</a></li>
<li><a href="https://pythonhosted.org/Markdown/extensions/abbreviations.html">abbr</a></li>
<li><a href="https://pythonhosted.org/Markdown/extensions/definition_lists.html">def_list</a></li>
<li><a href="https://pythonhosted.org/Markdown/extensions/toc.html">toc</a> Since July 2015, the header permalink setting has been enabled.</li>
<li><a href="https://pythonhosted.org/Markdown/extensions/code_hilite.html">codehilite</a></li>
<li><a href="https://pythonhosted.org/Markdown/extensions/footnotes.html">footnotes</a></li>
<li><a href="https://svn.apache.org/repos/infra/websites/cms/build/mdx_elementid.py">elementid</a> extension.</li>
<li><a href="https://pythonhosted.org/Markdown/extensions/attr_list.html">attr_list</a> (Since July 2015)</li>
</ul>
<p>All but 'elementid' are part of the <a href="https://pythonhosted.org/Markdown/extensions/index.html">Python Markdown extensions</a>
which implement most of the syntax as originally developed for the PHP 'Markdown Extra' as documented in
<a href="https://pythonhosted.org/Markdown/extensions/index.html">https://pythonhosted.org/Markdown/extensions/index.html</a></p>
<p>The 'elementid' extension allows an id or a class to be added to a header or block level element.
Ids that are added to non-header elements automatically generate permalinks which appear when the mouse hovers over the element.
Ids that are added with the 'attr_list' syntax do not result in a permalink.</p>
<p>For example, using the elementid format to add an id:</p>
<div class="codehilite"><pre><span class="n">some</span> <span class="n">text</span> <span class="p">{</span>#<span class="n">id1</span><span class="p">}</span>
</pre></div>


<p>generates the following with a permalink which appears on hover:</p>
<p id="id1">some text<a class="elementid-permalink" href="#id1" title="Permanent link">&para;</a></p>
<p>whereas using the attr_list syntax</p>
<div class="codehilite"><pre><span class="n">some</span> <span class="n">more</span> <span class="n">text</span>
<span class="p">{:</span> #<span class="n">id2</span> <span class="p">}</span>
</pre></div>


<p>generates the following with no permalink marker (but the id is still generated and can be used as an <a href="#id2">anchor</a>)</p>
<p id="id2">some more text</p>
<p>Note: previous versions of this page stated that the <a href="https://pythonhosted.org/Markdown/extensions/header_id.html">headerid</a> extension was included.
However this has not been the case for some while.</p>
<h1 id="flow">CMS Information Flow - Edit/Commit, Build, Stage, Publish<a class="headerlink" href="#flow" title="Permanent link">&para;</a></h1>
<p>A user creates a mdtext file with the webclient in his/her own workspace,
or in a working copy of the site's source.  After a commit the following
stages occur:</p>
<h2 id="staging">Staging<a class="headerlink" href="#staging" title="Permanent link">&para;</a></h2>
<p>Staging is initiated by a commit to the svn repository.</p>
<ul>
<li>The mdtext file is converted to html by the build and written to the staging site.</li>
<li>The converted html file is committed from the staging site to the staging repo.</li>
<li>The user can test the full generated site in staging before publishing all changes. </li>
</ul>
<h2 id="publishing">Publishing<a class="headerlink" href="#publishing" title="Permanent link">&para;</a></h2>
<p>Publishing is initiated by clicking the [publish] link in the webclient (refresh page if using back button from your webclient), or by
running <a href="http://s.apache.org/cms-cli">http://s.apache.org/cms-cli</a> from the command line.</p>
<ul>
<li>the changes from the staging site are cheap-copied into the production URL
   by the POST to the publish link.</li>
<li>subsequently svnpubsub notifies the main webserver of the change and the webserver
   svn up's the site.</li>
<li><strong>Important:</strong> When you Publish a specific website, you are actually pushing any 
   changed content for that <strong>entire</strong> website - not just your own changes (if there are any).</li>
<li>To see what will be published, click the Diff link to see the changes that will
    be pushed from staging to production.</li>
</ul>
<h1 id="faq">FAQ - Anonymous/Non-Committer Use<a class="headerlink" href="#faq" title="Permanent link">&para;</a></h1>
<h2 id="non-committer">I'm not a committer on $project, which uses the CMS.  Can I still use the CMS?<a class="headerlink" href="#non-committer" title="Permanent link">&para;</a></h2>
<p>If you are currently an Apache committer and want to submit a patch to the $project
dev list using the CMS, you can do that right now.  Simply use the bookmarklet and
pull up an <code>Edit</code> session for the page in question and submit your changes (avoiding <code>Quick Commit</code>).
Then view the subsequent <code>Diff</code> link, which will provide a link to the <code>Mail Diff</code> feature.
Fill in the form and your changes will be mailed to any <code>apache.org</code> address you choose
(but only one address per mailout please).</p>
<p>More enlightened projects like <a href="http://lucy.apache.org/">Apache Lucy</a> already grant any Apache committer
write-access to their site's source tree (but maintain tighter controls for publication), so go ahead and
try committing first before bothering with the <code>Mail Diff</code> feature.</p>
<p>Non-committers can still checkout the site in <code>svn</code> and submit patches to the list.
Otherwise they may access the CMS using username <strong>anonymous</strong> and an <strong>empty password</strong> and
use the <code>Mail Diff</code> feature (or <code>Quick Mail</code>) mentioned above to send patches to the list from the CMS.
Anonymous working copies created in the CMS may be <a href="http://s.apache.org/cms-anonymous-clone">cloned</a>
by any project committer, so it is relatively trivial for committers to apply such diffs using the CMS webgui.
The workflow of an anonymous user follows the typical workflow of a committer- the only difference is that
they'll be mailing off diffs to the dev list instead of directly committing their changes.  In other words
they follow the Review-Then-Commit model, whereas committers follow Commit-Then-Review.  In particular
the first thing a non-committer should do is install the <a href="https://anonymous:@cms.apache.org/#bookmark">bookmarklet</a>
using the anonymous passwordless account and start browsing the project's live site looking for pages to change.</p>
<p>A video tutorial by Rob Weir for anonymous users is available at <a href="http://s.apache.org/cms-anonymous-tutorial">http://s.apache.org/cms-anonymous-tutorial</a>.</p>
<p><strong>NOTICE:</strong> unless indicated otherwise on the pages in question, all editable content available
from <code>cms.apache.org</code> is presumed to be licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License (AL) version 2.0</a>
and hence all submissions to <code>cms.apache.org</code> treated as formal Contributions under the license terms.</p>
<h3 id="anonymous-contributions">Information for committers working with anonymous contributions<a class="headerlink" href="#anonymous-contributions" title="Permanent link">&para;</a></h3>
<p>Do keep in mind however that cloning (snapshots of) working copies creates an unmanaged dependency on that
working copy, so if there comes a time to destroy that working copy, a committer's clone will be destroyed
as well.  If you are a committer planning to do extensive editing, have recently (within the past 3 days)
worked on a cloned working copy, and would like to avoid this situation, you can "force" a new working copy
(hence destroying an existing clone) by visiting <a href="https://cms.apache.org/">https://cms.apache.org/</a> and clicking on the appropriate link.
You can tell if your working copy was cloned from another user if the url has another user's id in it right after yours.
Committers should also be aware of the fact that cloning a working copy necessarily involves XSS risks, so you
should carefully review the relevant diffs (e.g. by searching diff pages for "script", "src" and "href" entries)
to ensure nothing nefarious is being introduced into your browser (though there is little available to a hacker
to exploit as none of the cookies from <code>cms.apache.org</code> contain sensitive information).  In particular <em>be wary
of any unusual or unexpected password prompts</em> appearing while visiting a cloned working copy- you won't be
prompted for your password again by the CMS once you have first logged in, unless you have changed your LDAP
password elsewhere during your browser session.  If you do see an anomalous password prompt, it probably wasn't
from us, so be sure to report it to your dev list and/or users@infra - the normal cleanup procedure involves
nuking the bogus working copy either by sysadmin intervention or by someone logging in as anonymous and forcing
a new working copy (which achieves the same effect).</p>
<h2 id="anonymous-add">I'm having trouble committing changes from an anonymous clone after applying changes which added files or directories.<a class="headerlink" href="#anonymous-add" title="Permanent link">&para;</a></h2>
<p>The workflow is slightly more complicated when dealing with anonymous user additions to the site, as opposed to modifications
of existing pages.  Once the anonymous user notices their additions have been applied, they need to [Revert] and [Update] those
resources (in either order) before continuing on with any further edits, otherwise svn will mark their tree as conflicted
and prevent future commits to that subtree from any subsequent clones.</p>
<h1 id="faq-how-to-use-editing-tools">FAQ - How To Use Editing Tools<a class="headerlink" href="#faq-how-to-use-editing-tools" title="Permanent link">&para;</a></h1>
<h2 id="quick-commit">What is <code>Quick Commit</code> and why would I use it?<a class="headerlink" href="#quick-commit" title="Permanent link">&para;</a></h2>
<p>If you are making a simple edit to a single page, Quick Commit will save you the
trouble, after you've submitted your edits, of pulling up the <code>Commit</code> screen,
filling in the Log Message, and hitting <code>Submit</code>.  It is a convenient feature
that probably should be used for 80% of your work in the CMS.</p>
<h2 id="bookmarklet-edit">Why doesn't the bookmarklet take me directly to the <code>Edit</code> screen for a page?<a class="headerlink" href="#bookmarklet-edit" title="Permanent link">&para;</a></h2>
<p>The default <a href="https://cms.apache.org/#bookmark">CMS bookmarklet</a> takes you to a <code>Browse</code> screen for 2 reasons:</p>
<ol>
<li>to get people familiar with the features of the CMS</li>
<li>because the bookmarklet sometimes doesn't take you to the resource you want.</li>
</ol>
<p>An example of 2 is the following url: <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>.
Instead of taking you to the <code>.mdtext</code> representation it takes you to the <code>.txt</code> one,
because httpd's <a href="http://httpd.apache.org/docs/2.2/mod/mod_negotiation.html">mod_negotiation</a>
prefers the shorter representation when other factors are equal.</p>
<p>However if you still prefer to have the bookmarklet take you to the <code>Edit</code> screen,
simply hack the bookmarklet to add an <code>action=edit</code> parameter to the query string.
Like this for example: <a href="javascript:location.href='https://cms.apache.org/redirect?action=edit;uri='+escape(location.href)">ASF CMS</a>.</p>
<p><a href="#non-committer">Non-committers can still use the bookmarklet</a>.</p>
<h2 id="new-file-diffs">How come the publish link doesn't show diffs of newly added files?<a class="headerlink" href="#new-file-diffs" title="Permanent link">&para;</a></h2>
<p><code>svn diff</code> doesn't show diffs of copied files, which is what the [Publish Site] link
does with added files.  There is an option available in subversion 1.7 that enables
diffs of copied files.</p>
<h2 id="link-safety">Is it safe to click on the <code>Static</code>, <code>Staged</code>, or <code>Production</code> links?  What do each of these do?<a class="headerlink" href="#link-safety" title="Permanent link">&para;</a></h2>
<p>As the CMS is a REST application, no HTTP GET operations change server state- you will have to POST form data for that to 
happen. Hence any links presented in the webgui are safe to click on.  The <code>Static</code> links just provide you a raw view of the
underlying source files. <code>Staged</code> shows the current view of the file on the staging site, and <code>Production</code> shows the current
view of the file on the live production site.</p>
<h2 id="force-site-build">How do I force the CMS to do a full site build?<a class="headerlink" href="#force-site-build" title="Permanent link">&para;</a></h2>
<p>Simply make a trivial change to a file in the templates/ or lib/ directory.</p>
<h2 id="add-resource">How do I add a new file or directory to my site?<a class="headerlink" href="#add-resource" title="Permanent link">&para;</a></h2>
<p>To add a resource you first edit a directory by clicking on the <code>Edit</code> link to a
directory.  Then you add the name of the new file or directory to the form input
field at the top of the page; directories are signified by a trailing '/' in their
name.  Hit enter and a form will be provided to create the new file or directory. </p>
<h2 id="svnpubsub-revision">What revision of the site is currently being served?<a class="headerlink" href="#svnpubsub-revision" title="Permanent link">&para;</a></h2>
<p>This answer pertains to any svnpubsub site, not only to CMS site, and as such
is given <a href="http://www.apache.org/dev/project-site#svnpubsub-revision">in the ASF svnpubsub instance documentation</a>.</p>
<h2 id="cleanup">We've completely restructured our site and now there are a lot of leftover files on the live site.  How do we clean things up?<a class="headerlink" href="#cleanup" title="Permanent link">&para;</a></h2>
<p>Simply delete the <code>content</code> and <code>cgi-bin</code> (or <code>lib</code>) subdirs of your staging tree within
<a href="https://svn.apache.org/repos/infra/websites/staging">https://svn.apache.org/repos/infra/websites/staging</a> and THEN <a href="#force-site-build">trigger a full
site build</a>.  Order counts- please do not delete those directories
while a build is underway!  Publishing your changes will clean things
up on the live site.</p>
<h2 id="executables">Help!  My download cgi scripts are serving up Internal Server Errors!<a class="headerlink" href="#executables" title="Permanent link">&para;</a></h2>
<p>You probably forgot to set the executable bit on the scripts' initial checkin.  The CMS does not
preserve propset edits post-initial-commit, so you'll have to coax the change through to all
three svn trees: the source tree, the staging tree, and the production tree.  To change the property
simply do</p>
<div class="codehilite"><pre><span class="c">% svn propset svn:executable &#39;*&#39; /path/to/script/on/local/filesystem</span>
<span class="c">% svn commit -m &#39;set executable flag on script&#39;</span>
</pre></div>


<p>The base of the staging tree is located at <a href="https://svn.apache.org/repos/infra/websites/staging">https://svn.apache.org/repos/infra/websites/staging</a>
and the production tree's base correspondingly at <a href="https://svn.apache.org/repos/infra/websites/production">https://svn.apache.org/repos/infra/websites/production</a>.
Note: do NOT check out the base of the trees! Navigate to your project's website assets in the proper subdir.</p>
<h1 id="faq-markdown-and-content-questions">FAQ - Markdown and Content Questions<a class="headerlink" href="#faq-markdown-and-content-questions" title="Permanent link">&para;</a></h1>
<h2 id="django-version">What version of Django's template library does the CMS use?<a class="headerlink" href="#django-version" title="Permanent link">&para;</a></h2>
<p>The CMS uses a fork of <code>Dotiac::DTL</code> version 0.8, which seems to implement
<a href="http://docs.djangoproject.com/en/1.1/ref/templates/builtins/">this version</a>
of django templates.</p>
<h2 id="code-hilighter">How do I use the code highlighter?<a class="headerlink" href="#code-hilighter" title="Permanent link">&para;</a></h2>
<p>Some questions have arisen regarding the syntax hilighter on code blocks.
Basically the guessing algorithm isn't too great, so to give it help
explicitly tell it which lexer to use from the list of short names here:</p>
<p><a href="http://pygments.org/docs/lexers/">http://pygments.org/docs/lexers/</a></p>
<p>What you do is prefix your code/text block with an indented ":::shortname"
or "#!shortname", where shortname is the name of the lexer to use. Often you
want to use ":::text" just to tell the codehilighter to do nothing special
to the indented block. The ":::shortname" variant will not supply line numbers
whereas the "#!shortname" variant will.</p>
<h2 id="nested-lists">How come my nested lists don't render properly?<a class="headerlink" href="#nested-lists" title="Permanent link">&para;</a></h2>
<p>The python implementation of markdown insists on 4-space indents per nesting level.</p>
<h2 id="markdown-conversion">How do I verify the <code>markdown -&gt; html</code> conversion by the python implementation, <em>before</em> committing my changes?<a class="headerlink" href="#markdown-conversion" title="Permanent link">&para;</a></h2>
<p>All you need to do is <code>Browse</code> your changes after submitting your edits (in this
case you want to avoid using <code>Quick Commit</code>).</p>
<h2 id="navigation">How do I create per-directory navigation links in the CMS?<a class="headerlink" href="#navigation" title="Permanent link">&para;</a></h2>
<p>The main idea is to <code>{% include navigation %}</code> in your site template, where <code>navigation</code>
is a Django variable name.  How you construct this variable and pass it along to the 
site template is up to you- you could break out separate paths in <code>path.pm</code> and add the
per-path <code>navigation</code> to the argument list of each path.  Alternately you could use
<code>view.pm</code> to process the path and generate a <code>navigation</code> argument using regexp captures
from <code>path.pm</code>.  See the <a href="#first">first</a> and <a href="#second">second</a> examples for additional details.</p>
<p>Note: <code>%path::dependencies</code> provides support for page dependencies that may be used to reflect
navigation links for things like directory index pages.  These are made available as a sorted arrayref
in the <code>deps</code> template argument for the standard
<a href="https://svn.apache.org/repos/infra/websites/cms/build/lib/ASF/View.pm">ASF::View</a>
views .  Loops in the dependency graph are supported
with careful application of the <code>quick_deps</code> argument to short-circuit the full dependency builds.
Complex dependencies can be created through the <code>walk_content_tree</code> sub in
<a href="https://svn.apache.org/repos/infra/websites/cms/build/lib/ASF/Util.pm">ASF::Util</a>.</p>
<h2 id="mail-link">How do I make the mail archives for my TLP accessible through the /mail URL?<a class="headerlink" href="#mail-link" title="Permanent link">&para;</a></h2>
<p>The /mail URL is implemented by a symlink to <code>/home/apmail/public-arch/$project.apache.org</code>.  As the CMS does not
natively support the use of symlinks, you will need to add this symlink to your production site and add a
corresponding line: "mail", to the <code>extpaths.txt</code> file in your source tree (mentioned <a href="#generated-docs">earlier</a>).
Here are the manual steps:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span class="gp">%</span> svn co --depth<span class="o">=</span>immediates https://svn.apache.org/repos/infra/websites/production/<span class="nv">$project</span>/content
<span class="gp">%</span> <span class="nb">cd </span>content
<span class="gp">%</span> ln -s /home/apmail/public-arch/<span class="nv">$project</span>.apache.org mail
<span class="gp">%</span> svn add mail
<span class="gp">%</span> svn commit -m <span class="s1">&#39;add mail link&#39;</span> mail
<span class="gp">%</span> <span class="nb">cd</span> ..
<span class="gp">%</span> rm -rf content
<span class="gp">%</span> svn co --depth<span class="o">=</span>immediates https://svn.apache.org/repos/asf/<span class="nv">$project</span>/site/trunk/content
<span class="gp">%</span> <span class="nb">cd </span>content
<span class="gp">%</span> <span class="nb">echo </span>mail &gt;&gt; extpaths.txt
<span class="gp">%</span> svn add extpaths.txt
<span class="gp">%</span> svn commit -m <span class="s1">&#39;add mail to extpaths.txt&#39;</span> extpaths.txt
</pre></div>
</td></tr></table>

<p>If you have time you may continue on to publish the <code>extpaths.txt</code> file, but it isn't strictly required so long
as the document correctly appears on the staging site.</p>
<h1 id="faq-cms-command-line-build-tools">FAQ - CMS Command Line Build Tools<a class="headerlink" href="#faq-cms-command-line-build-tools" title="Permanent link">&para;</a></h1>
<h2 id="local-build">How do I run the CMS build scripts?<a class="headerlink" href="#local-build" title="Permanent link">&para;</a></h2>
<p>There are two separate folders to be aware of when running the build scripts.
The first is the root folder of your CMS site that stores your content, the folder which
has "<code>content</code>" and "<code>cgi-bin</code>" (or "<code>lib</code>") as immediate child directories.  For example, for the
incubating Apache JSPWiki, it would be <a href="http://svn.apache.org/repos/asf/incubator/jspwiki/site/trunk/">http://svn.apache.org/repos/asf/incubator/jspwiki/site/trunk/</a>.
The second folder is the one housing the build scripts used to build your site, 
which can be checked out from <a href="https://svn.apache.org/repos/infra/websites/cms/build/">https://svn.apache.org/repos/infra/websites/cms/build/</a> and 
stored wherever desired on your local computer.</p>
<p>The Perl script that generates the <code>*.html</code> site files from <code>*.mdtext</code> is <code>build_site.pl</code>
in the build scripts folder. The <code>build_site.pl</code> script has some Python
dependencies.  The easiest way to install these is to use the Python
setuptools. First check your version of Python <code>python --version</code>
and follow the instructions to install the appropriate set of tools from here 
<a href="http://pypi.python.org/pypi/setuptools">http://pypi.python.org/pypi/setuptools</a>.</p>
<p>After the python setuptools are installed, other python dependencies can be 
installed as follows:</p>
<div class="codehilite"><pre><span class="gp">$</span> sudo easy_install Pygments
<span class="gp">$</span> sudo easy_install ElementTree <span class="o">(</span>Not completely sure that this is needed<span class="o">)</span>
<span class="gp">$</span> sudo easy_install Markdown
</pre></div>


<p>Depending on your Perl installation, you may need to install some CPAN modules first.  A few users have had to install the 
following CPAN modules due to the use of the ASF::Value module:</p>
<ul>
<li>install XML::Atom::Feed</li>
<li>install XML::RSS::Parser::Lite</li>
<li>install XML::Parser::Lite</li>
<li>install YAML::XS</li>
<li>install SVN::Client</li>
<li>install Net::Twitter</li>
</ul>
<p>You may also need to do a force install depending on your setup.</p>
<p>Once everything is installed, navigate to the root folder of your CMS site and
run the following command:</p>
<div class="codehilite"><pre><span class="gp">$</span> <span class="nb">export </span><span class="nv">MARKDOWN_SOCKET</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/markdown.socket <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
</pre></div>


<p>Next, navigate back to the build script directory (preferably in the same
command window, as the
above environment variables must be set) and run:</p>
<div class="codehilite"><pre><span class="gp">$</span> python markdownd.py
</pre></div>


<p>to get the markdown processing daemon up.  Note: the local <code>mdx_elementid.py</code>
markdown extension we use has now been updated to py-markdown 2.x, so earlier
versions of the markdown module won't work any more.</p>
<p>Next, you'll need to update your PERL5LIB environment variable to point to the lib 
subdirectory of the CMS content root folder (not the lib in the build scripts directory).
(If this is not set properly you may get "Can't locate path.pm in @INC" error messages when running
build_site.pl.)  Enter perl -V from a command line to make sure this directory is available.</p>
<p>Then finally run build_site.pl from the scripts folder, for example:</p>
<div class="codehilite"><pre><span class="gp">$</span> perl build_site.pl --source-base /content/root/folder --target-base /desired/output/folder
</pre></div>


<h2 id="external-build">How do I use the CMS with an external build system?<a class="headerlink" href="#external-build" title="Permanent link">&para;</a></h2>
<p>Ensure your build system is supported on the <code>cms.apache.org</code> host and supply
the proper <code>@system_args</code> to <a href="https://svn.apache.org/repos/infra/websites/cms/build/build_external.pl">build_external.pl</a>.
The following build systems are already supported (<code>@system_args</code> for them has
been determined): Ant, Forrest, Maven, and arbitrary <code>build_cms.sh</code> shell
scripts.</p>
<p>The default Perl-based build system (<code>view.pm</code>/<code>path.pm</code>) is not considered an
external build system.</p>
<h2 id="compat">How do I verify compatibility if I write a client app for the CMS?<a class="headerlink" href="#compat" title="Permanent link">&para;</a></h2>
<p>Assuming you're using json, you can verify API compatibility by checking
<a href="https://cms.apache.org/compat?version=$VERSION">https://cms.apache.org/compat?version=$VERSION</a> where <code>$VERSION</code> is the API
version of the CMS that your code was written against.</p>
<h2 id="generated-docs">How do I publish generated docs (eg. doxygen)?<a class="headerlink" href="#generated-docs" title="Permanent link">&para;</a></h2>
<p>First place all your generated docs into a local directory, let's call it foo/.
Next create a compressed archive of foo/ by running</p>
<div class="codehilite"><pre><span class="gp">$</span> tar -czf foo.tar.gz foo
</pre></div>


<p>Then in the CMS navigate to the directory you'd like to add that directory to.  Pull
up the <code>Edit</code> screen and type "foo/" into the form field.  Then hit enter.  Fill
in the file upload widget by pointing it at foo.tar.gz, click on "Quick Commit", add
a log message, and hit Submit.  Wait while the staging site builds the docs, and
when that process is completed click <code>Publish Site</code> and Submit.  Please note that
the name of the local directory you archived must match the name of the directory
to be added to the CMS.</p>
<p>The way to maintain this setup is to use the CMS to delete stale doc trees and
replace them with fresh versions.</p>
<p>More sophisticated projects should be capable of scripting this into their
release packaging process.  The requests to the CMS would look something like
this (in Perl):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span class="nv">$ua</span> <span class="o">=</span> <span class="nn">LWP::</span><span class="n">UserAgent</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="n">requests_redirectable</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">]);</span>  
<span class="nv">$ua</span><span class="o">-&gt;</span><span class="n">default_header</span><span class="p">(</span><span class="n">Accept</span> <span class="o">=&gt;</span> <span class="s">&quot;application/json&quot;</span><span class="p">);</span>
<span class="nv">$ua</span><span class="o">-&gt;</span><span class="n">credentials</span><span class="p">(</span><span class="s">&quot;cms.apache.org:443&quot;</span><span class="p">,</span> <span class="s">&quot;ASF Committers&quot;</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">);</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$ua</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">(</span><span class="s">&quot;https://cms.apache.org/redirect?action=delete;uri=$urlencoded_uri_of_website_doctree&quot;</span><span class="p">);</span>
<span class="nv">$delete_uri</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;Location&quot;</span><span class="p">)</span>
    <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;Missing Location header&quot;</span><span class="p">;</span>
<span class="nv">$delete_uri</span> <span class="o">.=</span> <span class="s">&quot;/&quot;</span> <span class="k">unless</span> <span class="nv">$delete_uri</span> <span class="o">=~</span> <span class="sr">m!/$!</span><span class="p">;</span>
<span class="c1">## be careful here, if you screwed up the uri above you could wind up deleting your entire site.</span>
<span class="nv">$delete_uri</span> <span class="o">=~</span> <span class="sr">m!/trunk/content/$!</span> <span class="ow">and</span> <span class="nb">die</span> <span class="s">&quot;Won&#39;t delete entire site!&quot;</span><span class="p">;</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$ua</span><span class="o">-&gt;</span><span class="n">post</span><span class="p">(</span><span class="nv">$delete_uri</span><span class="p">,</span> <span class="p">[</span> <span class="n">submit</span> <span class="o">=&gt;</span> <span class="s">&quot;Submit&quot;</span> <span class="p">]);</span>
<span class="nb">die</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="n">status_line</span> <span class="k">unless</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="n">is_success</span><span class="p">;</span>
<span class="nv">$commit_uri</span> <span class="o">=</span> <span class="nv">$delete_uri</span><span class="p">;</span>
<span class="nv">$commit_uri</span> <span class="o">=~</span> <span class="sr">s!/delete/!/commit/!</span><span class="p">;</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$ua</span><span class="o">-&gt;</span><span class="n">post</span><span class="p">(</span><span class="nv">$commit_uri</span><span class="p">,</span> <span class="p">[</span> <span class="n">submit</span> <span class="o">=&gt;</span> <span class="s">&quot;Submit&quot;</span><span class="p">,</span> <span class="n">message</span> <span class="o">=&gt;</span> <span class="s">&quot;deleting stale doc tree&quot;</span> <span class="p">]);</span>
<span class="nb">die</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="n">status_line</span> <span class="k">unless</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="n">is_success</span><span class="p">;</span>
<span class="nv">$add_uri</span> <span class="o">=</span> <span class="nv">$delete_uri</span><span class="p">;</span>
<span class="nv">$add_uri</span> <span class="o">=~</span> <span class="sr">s!/delete/!/add/!</span><span class="p">;</span>
<span class="c1">## put new doctree into foo.tar.gz</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$ua</span><span class="o">-&gt;</span><span class="n">post</span><span class="p">(</span><span class="nv">$add_uri</span><span class="p">,</span> <span class="n">Content_Type</span> <span class="o">=&gt;</span> <span class="s">&#39;form-data&#39;</span><span class="p">,</span> <span class="n">Content</span> <span class="o">=&gt;</span> <span class="p">[</span>
   <span class="n">submit</span> <span class="o">=&gt;</span> <span class="s">&quot;Submit&quot;</span><span class="p">,</span>
   <span class="n">message</span> <span class="o">=&gt;</span> <span class="s">&quot;new doctree&quot;</span><span class="p">,</span>
   <span class="n">commit</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
   <span class="n">file</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s">&quot;foo.tar.gz&quot;</span> <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table>

<p>Then use the <a href="http://s.apache.org/cms-cli">http://s.apache.org/cms-cli</a> script to publish the site (once
the staging build has completed).</p>
<p>On the other hand, if you find that after a while of doing this your CMS source tree seems
bogged down in generated documentation trees, making dealing with the site unwieldy, there is
a handy gadget here: simply create a <code>content/extpaths.txt</code> (or <code>content/resources/extpaths.txt</code>
for maven builds) file which lists the paths (relative to your docroot) of the bases of the
documentation trees, then after committing that file to your tree you may purge your
source tree of those documentation trees and publish your site.  The publishing process
will keep track of those trees to ensure they remain accessible on your site.  If you
ever tire of publishing one of those trees simply remove the corresponding line from
<code>extpaths.txt</code>, commit and republish.  See <a href="http://www.apache.org/extpaths.txt">http://www.apache.org/extpaths.txt</a> for an
example+description of the file format.  Note that once added to the file, such urls
are essentially frozen unless/until either the entry is removed or someone commits a change
directly to its corresponding <a href="https://svn.apache.org/repos/infra/websites/production">production tree</a>
in svn.</p>
<h2 id="extpaths">What is extpaths.txt?<a class="headerlink" href="#extpaths" title="Permanent link">&para;</a></h2>
<p>There are 3 trees in play in the CMS:</p>
<ul>
<li>the source tree in the <a href="https://svn.apache.org/repos/asf/"><code>asf</code></a><code>/&lt;project&gt;/site</code>,</li>
<li>the staging tree in <a href="https://svn.apache.org/repos/infra/websites/staging/"><code>infra/websites/staging</code></a><code>/&lt;project&gt;</code></li>
<li>and the production tree in <a href="https://svn.apache.org/repos/infra/websites/production/"><code>infra/websites/production</code></a><code>/&lt;project&gt;</code>.</li>
</ul>
<p><code>extpaths.txt</code> lists paths to preserve in the production tree,
after they are deleted from the source tree and then
subsequently deleted from the staging tree by buildbot.</p>
<p><code>extpaths.txt</code> requires to be found in production tree at the root of the site: dependeing on the build system used
(CMS, Maven, Ant, Forrest), the location in the source tree may differ.</p>
<h2 id="buildbot-commits">Is there any way to turn off all these annoying buildbot commit messages appearing on our commit lists?<a class="headerlink" href="#buildbot-commits" title="Permanent link">&para;</a></h2>
<p>No- they are a core part of the CMS's internal bookkeeping and cannot be routed
elsewhere.  However they are not essential reading for projects whose site builds
are well-understood, so feel free to route those messages to <code>/dev/null</code>.</p>
<h2 id="mass-change">Help!  I made a massive commit to my CMS source tree and now I cannot use the CMS webgui, not even to publish the site!<a class="headerlink" href="#mass-change" title="Permanent link">&para;</a></h2>
<p>The CMS's internal working copies are updated daily; if your working copy has not pulled in the changes you will need
to <code>Update</code> your tree, which will take some time depending on the nature of the changes you need to pull in. (Note:
you do not need to update your working copy in order to publish the site.)</p>
<p>The CMS's publish operation has been recoded to be based on <code>svnmucc</code> and is now much faster.  If you think having massive
trees is a problem for svn, investigate <code>svn checkout --depth=immediates</code> and <code>svn update --parents --set-depth=infinity</code>.
You can checkout the base dir of a very large tree quickly and simply and modify/commit any files directly contained therein.
Let the CMS's build system do its job and worry about managing the full site sources so you don't have to.</p>
<h2 id="log-prod-child">Running <code>svn log</code> on a file in the production tree gives too many results!<a class="headerlink" href="#log-prod-child" title="Permanent link">&para;</a></h2>
<p>Don't do that.  Run log against either the source site (consulting the
<code>cms:source-revision</code> property to determine the associated revision) or the
<code>staging/</code> tree (consulting <code>svn log -v</code> on the production tree to determine
the associated staging revision).</p>
<h2 id="log-prod-staging">Running <code>svn log</code> on the production tree shows entries from staging.<a class="headerlink" href="#log-prod-staging" title="Permanent link">&para;</a></h2>
<p><code>svn log</code> crosses copies, including the copy operation that publish is now implemented by.
Run log one level up --- on <code>production/${project}</code> rather than
<code>production/${project}/content</code>.  (The log entries won't be very interesting;
consider running log on the staging tree instead.)</p>
<h1 id="techinfo">Technical Information About The CMS<a class="headerlink" href="#techinfo" title="Permanent link">&para;</a></h1>
<h2 id="svn">How To Setup A New CMS Site<a class="headerlink" href="#svn" title="Permanent link">&para;</a></h2>
<p>Easiest way to get setup quickly is to use the boilerplate site setup.  It has the right files in the right structure.
Just export it and add it to svn.</p>
<div class="codehilite"><pre><span class="n">svn</span> <span class="n">export</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">svn</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">infra</span><span class="o">/</span><span class="n">websites</span><span class="o">/</span><span class="n">cms</span><span class="o">/</span><span class="n">template</span> <span class="n">site</span>
<span class="n">svn</span> <span class="n">add</span> <span class="n">site</span>
<span class="n">svn</span> <span class="n">ci</span> <span class="n">site</span> <span class="o">-</span><span class="n">m</span> &quot;<span class="n">initial</span> <span class="n">setup</span> <span class="k">for</span> <span class="n">the</span> <span class="n">cms</span>&quot;
</pre></div>


<p>The location of your 'site' dir in svn is what Infra needs to get you setup in the CMS.  Make sure to include this
in your JIRA when requesting to use the CMS.</p>
<p>Once setup, you'll want to change the <code>site/trunk/templates/skeleton.html</code> file to use the look and feel you want
for your project.</p>
<p>Incubator podlings will need to make adjustments to the setup (mainly placing all content within content/$project)
to comply with the <a href="http://www.apache.org/dev/cms#layout">layout</a> for incubating projects.</p>
<p>Note that you will need to <strong>file a JIRA on the INFRA project</strong> requesting that your micro-site be incorporated into the
main web-site or under the incubator site.  You need to include a pointer to your site in SVN and the desired base
URL. </p>
<p id="setup">Once your site has been setup, you need to followup by making a trivial change to one of your perl modules in <code>/lib</code>
to trigger a full site build.  After a successful full build, proceed to publishing the site using the cms webgui.<a class="elementid-permalink" href="#setup" title="Permanent link">&para;</a></p>
<h2 id="organization">Organization of the webgui pages<a class="headerlink" href="#organization" title="Permanent link">&para;</a></h2>
<p>For those of you who intend to go poking around in the CMS webgui, a little primer on the link organization is in order.
There are essentially 2 main sets of links- those that come from the <em>browse</em> view and those that come from the <em>edit</em> view.
The <em>browse</em> links are there to give you different perspectives on the content, whereas the <em>edit</em> links are there to let you
alter it somehow.  When viewing a directory the only differences between the <em>browse</em> and <em>edit</em> views are the sets of links
presented, so it can sometimes be confusing which of those two views is operational.  Just look for <em>browse</em> or <em>edit</em> in the
title to keep them straight- eventually you will get used to recognizing the different link collections.</p>
<p>When you act on some content by POSTing form data, you will be given a brief list of links to select from.  The links are
ordered loosely in the order you are expected to click on them, and the UI isn't shy about expecting you to use your browser's
back button to return to the CMS.  One of the upsides of REST compliance is that the site is designed to facilitate state
management in your web browser, not through server-side contraptions.  Feel free to navigate back and forth to various
pages you have visited and reuse them (with whatever embedded state they contain) at will.</p>
<h2 id="exception">Single REST exception regarding commits<a class="headerlink" href="#exception" title="Permanent link">&para;</a></h2>
<p>There is a single exception here that you should be aware of: if you POST form data to commit something, and your 
server-side working copy has a stale version of that resource, the CMS will automatically update your working copy
and retry the commit- if this happens your prior editing session will be out of sync with the content you actually
committed as some external commit information may have been merged in the process.</p>
<p>The CMS will indicate this has happened by notifying you it had to merge external content on the post-commit page.
Hence avoid going back to a prior editing session once you've committed and simply use the [Edit] link provided on
the post-commit view to ensure you are working with the latest version of the resource.  If you are really in the
habit of going back anyway at this point, when you see the merge notification message do yourself and your project
a favor and refresh the <em>edit</em> page before you start hacking on the content again.</p>
<p>Note also that anonymous working copies will be updated daily between 0:00 and 0:15 UTC which can cause non-REST like behavior
if the files on the server get updated while an anonymous user is working on them.  However this tradeoff is worthwhile
from the standpoint of anonymous users who, while being infrequent users, tend to expect the content is current over
expecting it to be fully REST compliant.</p>
<h2 id="control-flow">Control Flow of the Standard Build System<a class="headerlink" href="#control-flow" title="Permanent link">&para;</a></h2>
<p>At a high level, the CMS is driven by a number of "views" that generate content, a process for selecting a "view" for a given 
changed file, and an optional set of additional named parameters to pass to the "view" so that "view" logic can be reused more easily.</p>
<p>Simply put, a "view" is a Perl method that is given the name of the changed file and expected to generate the actual HTML.
All view methods are defined in the <code>lib/view.pm</code> file or in a base class thereof.  Yes, essentially this means projects
"bring their own code" to generate content in this CMS- all by itself the CMS doesn't "know" how to do that for you.
Fortunately this isn't a difficult task and many other projects have managed to carry it out successfully, so a
basic familiarity with Perl and some study of the code of <a href="http://www.apache.org/dev/cmsadoption.html">existing sites</a> will get you what you need.</p>
<p>The process of selecting the correct view method is achieved through setting up an array of regular expressions (patterns) to match
the desired paths that should be used for a particular view method.  This is done in the <code>lib/path.pm</code> file, which should be
thought of as the "build's config file" for the site.</p>
<p>When configuring the pattern-to-view pair in the <code>lib/path.pm</code> file, it is also possible to supply an optional Perl hashref of
named parameters which will be passed to the view method allowing you to alter the view method logic as desired and
more easily reuse view methods.</p>
<h2 id="walkthrough">Detailed Walkthrough Of Edit/Commit, Build, Stage, Publish<a class="headerlink" href="#walkthrough" title="Permanent link">&para;</a></h2>
<p>When a commit triggers a build, the script that gets invoked is <a href="https://svn.apache.org/repos/infra/websites/cms/build/build_svn.pl">build_svn.pl</a>
which will update the local source tree checkout and keep track of what files have changed.  Depending on what has changed, that script will call
out to either <a href="https://svn.apache.org/repos/infra/websites/cms/build/build_site.pl">build_site.pl</a>
or <a href="https://svn.apache.org/repos/infra/websites/cms/build/build_file.pl">build_file.pl</a> which will build the corresponding
resources.  In either case, the core logic for building changed source files within <code>content/</code> is documented in the next section.</p>
<p><strong>Note:</strong> none of the build scripts run with <a href="http://s.apache.org/taint-checks">taint checks</a> <code>-T</code> enabled, because typically
none of the code is being exposed to third-party data.  Everything other than
<a href="https://svn.apache.org/repos/infra/websites/cms/build/lib/ASF/Value.pm">ASF::Value</a>
generated objects revolves around committer-approved material, not end-user input, so taint-checks are unnecessary.  As those
<code>ASF::Value</code> objects aren't typically evaluated for their data until template-execution time, they should not pose any
additional risks to committer-authored Perl code.  Furthermore the CMS build host is tightly locked down with both egress
and ingress firewalls to ensure no uncontrolled data winds up being processed by a build.</p>
<h3 id="core-logic">Core logic for building files<a class="headerlink" href="#core-logic" title="Permanent link">&para;</a></h3>
<p>The core logic for building individual files, common to both <code>build_site.pl</code> and <code>build_file.pl</code>, is contained in the
following block of Perl:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span class="k">for</span> <span class="k">my</span> <span class="nv">$p</span> <span class="p">(</span><span class="nv">@</span><span class="nn">path::</span><span class="nv">patterns</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$re</span><span class="p">,</span> <span class="nv">$method</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@$p</span><span class="p">;</span>
    <span class="k">next</span> <span class="k">unless</span> <span class="nv">$path</span> <span class="o">=~</span> <span class="nv">$re</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$sub</span> <span class="o">=</span> <span class="n">view</span><span class="o">-&gt;</span><span class="n">can</span><span class="p">(</span><span class="nv">$method</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;Can&#39;t locate method: $method\n&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$content</span><span class="p">,</span> <span class="nv">$ext</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$sub</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">path</span> <span class="o">=&gt;</span> <span class="nv">$path</span><span class="p">,</span> <span class="nv">%$args</span><span class="p">);</span>
    <span class="nv">$src</span> <span class="o">=</span> <span class="s">&quot;$target_file.$ext&quot;</span><span class="p">;</span>
    <span class="nb">open</span> <span class="k">my</span> <span class="nv">$fh</span><span class="p">,</span> <span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;$target_base/$src&quot;</span>
        <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;Can&#39;t open $target_base/$src: $!\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$fh</span> <span class="nv">$content</span><span class="p">;</span>
    <span class="nv">$matched</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">last</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">unless</span> <span class="p">(</span><span class="nv">$matched</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">copy_if_newer</span> <span class="nv">$src</span><span class="p">,</span> <span class="s">&quot;$target_base/$src&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The overall gist of this code block is that it will loop over the <code>@patterns</code> array in <code>lib/path.pm</code> looking
for an <code>$re</code> (first item in a <code>@patterns</code> entry) regex match for the given source <code>$path</code> (rooted in <code>content/</code>).  When
it finds a matching entry (on line 3), it does an OO-lookup (on line 4) for the corresponding <code>$method</code> (second item in a
<code>@patterns</code> entry) name in <code>lib/view.pm</code> and subsequently invokes that subroutine (on line 5) with the matching <code>$path</code>
(a Perl <code>=&gt;</code> is called a 'fat-comma' and simply wraps quotes around its left-side argument, converting barewords into strings)
and additional <code>%$args</code> (third item in a <code>@patterns</code> entry) configured from the matching line in <code>@patterns</code>.  The generated
<code>$content</code> is then written to the target file (on lines 7-9) with the adjusted extension (line 6).  It stops looping after
the first match, but if no matching <code>@patterns</code> entry is found, the <code>$src</code> file is simply copied verbatim (on line 14) to the
target tree.  Since the <code>@patterns</code> array is processed in order, it is important that more specific patterns appear earlier
than less specific ones.</p>
<p>Typically the view <code>$method</code> will pass along the %$args to the template responsible for rendering the resulting
content - in fact most view methods do nothing else other than enrich their arguments with suitably generated data to
pass along to the template.  The upshot of this is that it makes <strong>reuse</strong> of the <code>$method</code> code in <code>lib/view.pm</code> much more feasible
as different paths within <code>content/</code> can share the same <code>$method</code> by supplying different <code>%$args</code> in the <code>@patterns</code>
array in <code>lib/path.pm</code>- all you'd need to do is ensure the underlying template (which itself can be configured as an
argument in <code>%$args</code>) recognizes the various arguments.  In fact the whole point of the
<a href="https://svn.apache.org/repos/infra/websites/cms/build/lib/ASF/Value/">ASF::Value::</a> packages is to provide Apache-related
arguments, representing cheaply-constructed (<code>lib/path.pm</code> is expected to load itself quickly since it is required for <em>all</em>
builds), lazily-evaluated, dynamic template object variables, from an <code>%$args</code>
<a href="http://svn.apache.org/repos/asf/infrastructure/site/trunk/lib/path.pm">named parameter</a> in <code>@patterns</code>.</p>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<h4 id="first">First example<a class="headerlink" href="#first" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span class="k">our</span> <span class="nv">@patterns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">[</span> <span class="sx">qr!^/foo/.*\.mdtext$!</span><span class="p">,</span> <span class="n">single_narrative</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="n">header</span> <span class="o">=&gt;</span> <span class="s">&quot;foo-top.html&quot;</span><span class="p">,</span>
         <span class="n">footer</span> <span class="o">=&gt;</span> <span class="s">&quot;foo-bottom.html&quot;</span><span class="p">,</span>
       <span class="n">template</span> <span class="o">=&gt;</span> <span class="s">&quot;skeleton.html&quot;</span><span class="p">,</span>
    <span class="p">}</span> <span class="p">],</span>
<span class="o">...</span>
<span class="p">);</span>
</pre></div>


<p>This <code>lib/path.pm</code> array specifies that for a given <code>content/foo</code> dir, all markdown files will use the <code>single_narrative</code> view
method with the following arguments passed to it: <code>header</code>, <code>footer</code>, and <code>template</code>.  Typically the single_narrative view
is a generic view that can be cribbed from various <a href="http://www.apache.org/dev/cmsadoption.html">active</a> <code>view.pm</code> files, else it can be derived from the
<a href="https://svn.apache.org/repos/infra/websites/cms/build/lib/ASF/View.pm">ASF::View</a> base class.  The point here is that
all the action is specified in the arguments: custom header/footer template files that are recognized by <code>templates/skeleton.html</code>
perhaps via <code>{% include header %}</code> and <code>{% include footer %}</code> directives.  The header and footer templates would naturally
reside within <code>templates/</code> alongside the <code>skeleton.html</code> main template.  Similar functionality can provide for custom
<a href="#navigation">navigation</a>.</p>
<h4 id="second">Second example<a class="headerlink" href="#second" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span class="n">in</span> <span class="n">view</span><span class="o">.</span><span class="n">pm:</span>
<span class="k">sub </span><span class="nf">dir_wrapper</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span> <span class="c1"># here we expect the regexp in @patterns to capture the proper path component</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$nav</span><span class="p">,</span> <span class="nv">$hdr</span><span class="p">,</span> <span class="nv">$ftr</span><span class="p">)</span> <span class="o">=</span> <span class="nb">map</span> <span class="s">&quot;$dir/$_.html&quot;</span><span class="p">,</span> <span class="sx">qw/navigation header footer/</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">view</span><span class="o">-&gt;</span><span class="n">can</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="n">view</span><span class="p">})</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">dir</span> <span class="o">=&gt;</span> <span class="nv">$dir</span><span class="p">,</span> <span class="n">navigation</span> <span class="o">=&gt;</span> <span class="nv">$nav</span><span class="p">,</span> <span class="n">header</span> <span class="o">=&gt;</span> <span class="nv">$hdr</span><span class="p">,</span> <span class="n">footer</span> <span class="o">=&gt;</span> <span class="nv">$ftr</span><span class="p">,</span> <span class="nv">%args</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">in</span> <span class="n">path</span><span class="o">.</span><span class="n">pm:</span>
<span class="k">our</span> <span class="nv">@patterns</span> <span class="o">=</span> <span class="p">(</span>
   <span class="p">[</span> <span class="sx">qr!/([^/]+)/.*\.mdtext$!</span><span class="p">,</span> <span class="n">dir_wrapper</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="n">view</span> <span class="o">=&gt;</span> <span class="s">&quot;single_narrative&quot;</span><span class="p">,</span>
        <span class="n">template</span> <span class="o">=&gt;</span> <span class="s">&quot;subdir_skeleton.html&quot;</span><span class="p">,</span> <span class="c1"># perhaps this simply extends &quot;skeleton.html&quot;?</span>
        <span class="n">footer</span> <span class="o">=&gt;</span> <span class="s">&quot;footer.html&quot;</span><span class="p">,</span> <span class="c1"># overrides the dir_wrapper-generated &quot;foo/footer.html&quot; with a base footer.html for all subdirs</span>
    <span class="p">}</span> <span class="p">]</span>
<span class="p">);</span>
</pre></div>


<p>This code specifies a <code>dir_wrapper</code> view method that augments the <code>%args</code> with additional variables to the specified <code>view</code>
method.  The way it's being used here is to invoke the <code>single_narrative</code> view, which will simply pass those arguments
along to the configured <code>template</code>.  The <code>dir</code> argument simply specifies the top-level subdirectory of a given path within
<code>content/</code>, whereas <code>navigation</code>, <code>header</code>, and <code>footer</code> will be interpreted as corresponding paths one-subdir deep
within <code>templates</code>. These arguments are overridable by specifying them in the original <code>%$args</code> hashref in <code>@patterns</code> as is
done here with the <code>footer</code>.</p></div>

  <!-- Footer -->
  
  <footer class="bg-primary">
    <div class="container">
      <div class="row">
        <br />
        <div class="col-sm-1">

        </div>
        <div class="col-sm-2">
          <h5 class="white">Community</h5>
          <ul class="list-unstyled white" role="menu">
            <li><a href="http://community.apache.org/">Overview</a></li>
            <li><a href="http://www.apache.org/foundation/conferences.html">Conferences</a></li>
            <li><a href="http://community.apache.org/gsoc.html">Summer of Code</a></li>
            <li><a href="http://community.apache.org/newcomers/">Getting Started</a></li>
            <li><a href="http://www.apache.org/foundation/how-it-works.html">The Apache Way</a></li>
            <li><a href="http://www.apache.org/travel/">Travel Assistance</a></li>
            <li><a href="http://www.apache.org/foundation/getinvolved.html">Get Involved</a></li>
            <li><a href="http://www.apache.org/foundation/policies/conduct.html">Code of Conduct</a></li>
            <li><a href="http://community.apache.org/newbiefaq.html">Community FAQ</a></li>
            <li><a href="http://www.apache.org/memorials/">Memorials</a></li>
          </ul>
        </div>

        <div class="col-sm-2">
          <h5 class="white">Innovation</h5>
          <ul class="list-unstyled white" role="menu">
            <li><a href="http://incubator.apache.org/">Incubator</a></li>
            <li><a href="http://labs.apache.org/">Labs</a></li>
            <li><a href="http://www.apache.org/licenses/">Licensing</a></li>
            <li><a href="http://www.apache.org/foundation/license-faq.html">Licensing FAQ</a></li>
            <li><a href="http://www.apache.org/foundation/marks/">Trademark Policy</a></li>
            <li><a href="http://www.apache.org/foundation/contact.html">Contacts</a></li>
          </ul>
        </div>

        <div class="col-sm-2">
          <h5 class="white">Tech Operations</h5>
          <ul class="list-unstyled white" role="menu">
            <li><a href="http://www.apache.org/dev/">Developer Information</a></li>
            <li><a href="http://www.apache.org/dev/infrastructure.html">Infrastructure</a></li>
            <li><a href="http://www.apache.org/security/">Security</a></li>
            <li><a href="http://status.apache.org/">Status</a></li>
            <li><a href="http://www.apache.org/foundation/contact.html">Contacts</a></li>
          </ul>
        </div>

        <div class="col-sm-2">
          <h5 class="white">Press</h5>
          <ul class="list-unstyled white" role="menu">
            <li><a href="http://www.apache.org/press/">Overview</a></li>
            <li><a href="https://blogs.apache.org/">ASF News</a></li>
            <li><a href="https://blogs.apache.org/foundation/">Announcements</a></li>
            <li><a href="https://twitter.com/TheASF">Twitter Feed</a></li>
            <li><a href="http://www.apache.org/press/#contact">Contacts</a></li>
          </ul>
        </div>

        <div class="col-sm-2">
          <h5 class="white">Legal</h5>
          <ul class="list-unstyled white" role="menu">
            <li><a href="http://www.apache.org/legal/">Legal Affairs</a></li>
            <li><a href="http://www.apache.org/legal/dmca.html">DMCA</a></li>
            <li><a href="http://www.apache.org/licenses/">Licensing</a></li>
            <li><a href="http://www.apache.org/foundation/marks/">Trademark Policy</a></li>
            <li><a href="http://www.apache.org/foundation/records/">Public Records</a></li>
            <li><a href="http://www.apache.org/foundation/policies/privacy.html">Privacy Policy</a></li>
            <li><a href="http://www.apache.org/licenses/exports/">Export Information</a></li>
            <li><a href="http://www.apache.org/foundation/license-faq.html">Licensing FAQ</a></li>
            <li><a href="http://www.apache.org/foundation/contact.html">Contacts</a></li>
          </ul>
        </div>

        <div class="col-sm-1">
        </div>

      </div>
      <hr class="col-lg-12 hr-white" />
      <div class="row">
        <div class="col-lg-12">
          <p class="text-center">Copyright &#169; 2019 The Apache Software Foundation, Licensed under the <a class="white" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>
          <p class="text-center">Apache and the Apache feather logo are trademarks of The Apache Software Foundation. </p>
        </div>
      </div>
    </div>

  </footer>

  <!-- / Footer -->

  <script src="http://www.apache.org/js/jquery-2.1.1.min.js"></script>
  <script src="http://www.apache.org/js/bootstrap.js"></script>
  <script>
    (function($){
    $(document).ready(function(){
    $('ul.dropdown-menu [data-toggle=dropdown]').on('click', function(event) {
    event.preventDefault();
    event.stopPropagation();
    $(this).parent().siblings().removeClass('open');
    $(this).parent().toggleClass('open');
    console.log('WOrked');
    });
    });
    })(jQuery);
  </script>
</body>

<!-- Mirrored from www.apache.org/dev/cmsref.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jun 2019 09:33:31 GMT -->
</html>
